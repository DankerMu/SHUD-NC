## Implementation
- [ ] Preserve `n_all` and `icol[]` from legacy selection and reconstruct full-length arrays with fill values
- [ ] Write output masks per object type
- [ ] Add variable metadata registry (units + long_name at minimum)
- [ ] Add global attributes per file

## Validation
- [ ] Run with a partial output selection
- [ ] Verify fill/mask correctness and metadata presence

