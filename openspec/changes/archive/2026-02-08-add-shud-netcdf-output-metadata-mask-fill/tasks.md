## Implementation
- [x] Preserve `n_all` and `icol[]` from legacy selection and reconstruct full-length arrays with fill values
- [x] Write output masks per object type
- [x] Add variable metadata registry (units + long_name at minimum)
- [x] Add global attributes per file

## Validation
- [x] Run with a partial output selection
- [x] Verify fill/mask correctness and metadata presence

